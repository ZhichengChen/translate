#OMA DM BootStrap

##介绍

其他的OMA规范定义了一个管理会话是怎样建立和维护的。然而，为了使客户端也能发起一个管理会话，它必须提供相应的OMA DM设置。

引导是一个提供客户端一个能够启动一个到服务器的管理会话过程。已经被引导的客户端可以进一步的引导，来启动到一个新的服务器的管理会话，或者重新引导来更新账户。

##执行Bootstrap

###引导模式

DM 客户端需要通过一组庞大的协议并且可以通过不同的网络环境来被操作。这使得它很难找到“大而全”的解决方案。这章的开始是一些引导基本的要求，接着定义了三个不同的引导过程。

##要求

一个OMA DM 解决方案能够把一个干净的DM 客户端调整成能够启动一个管理会话的状态，它需要满足这些需求。

* 重用技术（WAP 推送，HTTP 推送）。
* 严格的的标准化，高度交互性，操作方便。 
* 完全的自给自足。
* 安全的（签名和认证）。
* 数据格式因该是基于XML的。
* 内容可映射到OMA DM 管理对象的。
* 传输编码应该是WBXML1.1，或者WBXML1.2，或者WBXML1.3。

####解决方案####

本文档定义了下列执行引导过程的方法。

* 定制引导：

设备在制造时就装载载了OMA DM账户以及连接信息，也称为工厂引导。

* 智能卡引导：

智能卡插在设备里，DM客户端从智能卡里初始化。

* 服务器发起的引导：

DM服务器通过一些推送机制比如WAP Push或者OBEX来发送引导信息。前提是，DM服务器需要知道设备的地址或者电话号码。

* 客户端发起的引导：

DM客户端从DM引导服务器接受引导信息，前提是设备已经知道服务器的URL。

DM客户端至少应该知道一种所支持流程的配置文件。（见5.3）.

#####定制引导

从用户的角度来看这是一个很方便的引导DM设备的方式，因为用户不需要做任何事情。在这种模式下，操作者这厂商那里提前配置好设备。关于使用者的网络信息和设备的硬件信息在设备出厂时就准备好了。这种模式的另一种好处是它非常安全。没有必要通过无线网络传输任何敏感的命令和信息，比如共享密钥。不管怎样这种模式非常不灵活，同时不是所有的制造商都提供这一种服务。也不是所有的设备都通过这种途径采购。当用户使用设备并完成引导后，DM 服务器和DM 客户端都可以启动一个OMA DM 管理会话。

图1概述了这个场景

图1

图1 定制引导

####智能卡引导

从终端用户的角度来看这也是一个方便的引导DM客户端的方式，因为用户也不需要做任何事情。在这种模式下DM客户端能够在智能卡里获取引导信息。没有必要通过无线网络来传递敏感命令和信息，比如共享密钥。在确保引导信息被认证的情况下，智能卡是非常安全的。如果设备支持智能卡引导，可么可以在没有运营商授权的情况下就可以引导设备，在DM客户端引导后，DM服务器和DM客户端都可以启动一个管理会话。

图2

图2 从智能卡引导

####服务器启动引导####

在这种模式下，设备刚刚离开装配线，是一个干净的状态，一旦用户想用设备并且做个性化设置，比如插入了一张SIM卡，这可能是其它不同的方式。现在的问题是来通知DM服务器设备的身份、地址和电话号码，这也可以通过很多种方式实现。

* 可以在销售点里获得信息，如果销售系统和管理系统是绑定在一起的。
* 可以通过用户在进入自助服务网站时输入电话号码获得。
* 可以在设备第一次注册网络时获得。总之是触发设备将使用的号码经由主要的连接网络发送到DM服务器里。
* 可以通过语音提示系统提示用户键入他的电话号码。

不管服务器怎样获得设备的地址和电话号码，现在假设服务器可以向用户发送引导信息。信息的结构和内容在这里会定义，包含的信息已经足够设备客户端向服务器发送一个管理会话信息。

DM客户端应该只从授权的服务器（DMSecurity）接收引导信息。

图3 模式预览

图3

图3 服务器发起的引导

####客户端发起引导

在这种模式下，DM客户端从DM引导服务器上检索引导包，前提是DM客户端得知道DM服务器的URL地址，就像图4的那样。在附录E里面描述了一个发现引导服务器的方法。在引导包被成功的安装后，DM客户端就开始尝试着向服务器启动一个管理连接。

图4

图4 客户端发起的引导

###提供OTA引导包

OTA（无线）通过OMA 推送来提供DM引导包。设备决定是否接受引导包的策略不再本规范的范围之内。一个可行的方法是，利用设备支持Push Management Object（PushMO）这一特性，它维护着一个叫做白名单的的东西，可以授权向设备发送OMA Push信息。在这种情况下设备仅当确认认证通过时才会执行Push message。

###引导配置

对于那些已经存在引导或者提供相应机制的设备，OMA DM的设计已经满足了很多种类型设备的管理需要。这种情况下OMA DM利用了现有的机制来向后兼容并且能够实现简单的部署。本文档介绍了引导配置的概念，定义了不同种类的设备是怎样引导的的，指出了OMA DM是怎样利用了存在的标准。每一个配置定义了它自己的安全机制、传输方式以及数据格式。目前计划了两种配置文件，但是随着对OMA DM兴趣的增长，更多的配置文件会被添加进来。设备管理配置必须要支持，其它的特殊配置要尽可能支持。

** OMA客户端配置 **

这个概要文件定义了OMA设备管(ERELDDM)是怎么应用与引导的。OMA客户端配置（ERELDCP）旨在向设备提供初始的配置信息，可以用来使设备能够被OMA设备管理（ERELDDM）管理。这一章指定了客户端提供的信息和设备管理数之间的映射，如果设备支持客户端提供信息的和管理设备，通过提供的参数来管理就很有可能了。

** OMA 设备管理

这个概要文件定义了OMA 设备管理（ERELDDM）怎样去引导。

OMA 客户端配置文件

OMA 客户端配置提供者（ERELDCP）旨在提供设备的初始配置信息，可以用OMA 设备管理提供者（ERELDCP）来给设备提供管理。这一章指定了客户端配置信息和设备管理树的映射。后台的配置参数应该无论对客户端配置和设备管理提供者来说都是可被设备支持的。

配置消息的内容是基于OMA Provisioning Content Specification（PROVCONT）的。为了在OMA设备管理框架里使用OMA Provisioning Content Specification，DM 小组发布了DM程序的注册文档w7（ACw7DM），w7提供了基于OMA Provisioning content（PROVONT）的应用的特点，进而提供了OMA 设备管理（ERELDDM）的参数。

##传输

引导使用的OMA 客户端配置文件在OMA Client Provisioning Bootstrap specification（PROVBOOT）里面有定义。

###特征数据和管理树之间的映射

当设备接受客户端配置文件时，DM客户端为每个DM 管理树的特征应用创建了一个管理对象。管理对象可以有两种不同类型的名称空间标识符（相应的在DMTND文档里面有描述）-其中一个标识符在DDF（DMTND）里面已经给出，另一个是字节点分离出来的实例（见图5）。

图5

图5 管理对象名称标识符的例子

名字节点的名称标识符已经在管理类DDF里面给出。同时，客户端配置参数和管理类参数之间的映射也可能在管理对象规范里面指定了。另外一般的规则也应该遵守名称信息的客户端配置特征应用和标准管理对象模板结构的映射，见附录C。

DM 客户端给动态节点的名称标识符和字节点的实例是有区别的。尽管这些动态节点的名称标识符的格式取决于它的实现形式，客户端可能指定一个从一开始的数字标识符，然后每次都增加1.在这种情况下，当在Provisioning Content 文档中优先指定配置时在这里会反映出来。

####管理对象在管理树里面的位置

新创建的管理对象在管理树的位置取决于DM 客户端。但是它必须位于已经发布了的DDF管理树的下面，以便服务器方便的找到它提供的信息。

####管理对象访问权限

所有从Provisioning Content（PROVCONT）文档映射到管理树的配置信息，对于Provisioning Content信息里面的w7 APPLICATION 特定配置，必须授权获得、替换和删除相应ServerID的ACL。在随后的DM会话中，拥有ServerID授权的管理者可能会修改ACL。在这种情况下，w7 APPLICATION characteristic 不是配置信息的一部分，对那些不符合DM 管理树信息的认证管理者必须拒绝访问这些参数。

####特殊行为-智能卡配置

当智能卡包含在（PROVSC）指定的配置信息的情况下，设备必须能检测到智能卡的移除或改变。也就是所，当智能卡被移除或改变时，DM客户端应从设备管理树里面该删除所有的配置管理对象的信息（来源于智能卡的）。

###设备管理，访问点和代理信息

设备支持的客户端配置和设备管理必须能映射w7（设备管理账户）、NAPDEF（如果支持）、PROXY（如果支持）的特征信息到DM 管理树上。映射的i名字节点在(DMSTDOBJ)里面指定。在附录C的（DMSTDOBJ）部分提供了一个w7到DMAcc的显示映射，同时附录C里也包含了应用特征的通用映射。就像5.4.2里面描述的那样，DM客户端必须给出动态节点的名字。设备支持客户端配置和设备管理可能决定了在客户端提供信息里的其它信息到DM管理树映射。如果一个在管理对象文档里描述了一个特定的机制，那么必须遵守这一映射。

####其他客户端配置信息

客户端支持客户端配置和设备管理，这决定了在客户端配置信息里面的其它配置信息和设备管理树的映射。如果在管理对象文档里面有一个特定的机制描述，那么它必须遵守下面的映射。

###OMA 设备管理配置文件

OMA DM 引导配置文件，包括DM客户端安装或更新的DMAcc（DMSTDOBJ）MO程序，会接收一个TNDS（DMTNDS）编码的引导文件。另外其它的MOs 可能也会被安装或更新。引导信息的内容是标准的OMA DM 信息。DM客户端的收件箱必须支持WBXML编码嵌入TNDS类及普通的TNDS类。为了成功的连接，DM 客户要求提供DM 账户信息和连接信息。强烈建议使用标准的链接MOs来表示连接信息。

####传输

请查阅针对传输和信息安全的（DMSecurity）security文档。

####管理树ACL和引导

设备决定是否否接收引导信息的策略已经超出了这个规范的范围。如果引导信息被设备接受了那么必须根据“Processing of the Bootsrap”的描述来执行。

####管理对象访问权限

当一个引导信息添加了一个新的TNDS对象时，任何为这些对象设置的ACL值必须包含在作为应用节点的ACL属性数据的TNDS数据里。

####引导信息内容

引导信息的内容是普通的DM 信息。然而，在一些方面上来讲它是一个特殊的包，因为它不属于一个正在进行的OMA DM会话而是一个一次性的消息。Hence，一些元素需要管理会话在这里被superfluous，但是为了使它们能在普通的DM 客户端执行，它们必须被包括在内。引导信息必须设置在（DMSTDOBJ）里的 DMAcc 管理对象的值。其它值（比如连接设置）可能也得设置。引导信息里面的SynHDR/Source/LocURI 元素的值必须匹配引导信息里面的 DMAcc 对象AppAddr//Addr 的一个节点的值。DM 引导信息必须是（WBXML1.2），或者（WBXML1.2），或者（WBXML1.3）编码的。DM服务器必须不期待对于这个引导信息返回任何响应信息。一个引导信息成功执行的一个间接确认是可以在客户端连接服务器时得到有了第一个管理会话。在DM Security document（DMSecutity）里面查看安全和加密的相关信息。

####引导的执行

一个引导信息执行和普通的DM 信息一样，当然还有一点区别是不会有一个响应消息发送过来。

客户端可能会重命名一个新的MO。在这种情况下服务器也应该重命名相应的连接，并且在相同的TNDS对象上所有的MO重新编码命名，否则会连接失败。

null

如果一个客户端遇到一个含有U

如果DM 客户端遇到一个不是预期准备处理EXT的URI的子树，为了消息的执行，客户端可以忽略这项。

在成功执行引导信息后，下一步DM 客户端应当通过引导信息里的任何一个DM Server配置启动一个管理会话，向每个受限配置的DMAcc引导服务器（不如，当网络连接或其它因素允许这样一个连接）。

如果引导信息里包含DM 客户端里不支持的MO，为了引导成功，DM客户端可能忽略这个MO。

如果引导信息里面包含多个版本的MO，为了引导顺利进行，DM客户端应该使用最新的版本，并且忽略其它的版本。

###智能卡

null

如果设备支持智能卡，DM客户端必须支持从智能卡检测、检索和执行引导信息，就像附录D描述的那样。DM 客户端可能包含可配置的禁用智能卡引导的安全策略。如果智能卡引导功能是开启的（比如，没有相应的安全策略或者禁用智能卡引导的安全策略没有开启），并且智能卡没有被设备拒绝（比如，通过SIM锁定机制），DM 客户端应该在设备开启的时候从智能卡里检索引导信息，并且应用他的设备配置。

如果智能卡仍然可用，那么当设备开启的时候DM 客户端应该从当前从智能卡引导的所有的DM 服务器检查引导数据。如果不是，之前从智能卡引导的但是现在不再存储在智能卡的DM 服务器信息因该从设备管理树中移除。

####通过HTTPS GET 引导

如果设备支持HTTP 协议，那么它可以通过一下的步骤从URL检索引导信息：设备通过 GET向引导服务器发起一个HTTPS请求；服务器向设备返回引导信息或者显示引导信息不可用（比如，返回404错误码）；如果有引导信息返回到设备，把它交给DM 客户端；在成功的验证引导信息后，DM 客户端按正常程序执行引导信息。

如果设备支持HTTPS 协议和（SCWS），它可能通过以下步骤用绝对URL 地址：“https://{SCWS@}/OMA/DM/Bootstrap.xml”检索引导信息，其中{SCWS@}依赖所支持的传输的IP地址的版本。

<table class="table table-bordered table-straped">     <tbody><tr>         <th>             Transport         </th>         <th>             IP version         </th>         <th>             {SCWS@}         </th>     </tr>     <tr>         <td rowspan="2">             BIP<br>             (Note 1)         </td>         <td>             IPv4          </td>         <td>             127.0.0.1:4116         </td>     </tr>     <tr>         <td>IPv6</td>         <td>[::1]:4116</td>     </tr>     <tr>         <td rowspan="2">             TCP/IP         </td>         <td>             IPv4          </td>         <td>             localuicc:443         </td>     </tr>     <tr>         <td>IPv6</td>         <td>localuicc:443</td>     </tr> </tbody></table> 注意：对于IPv4设备可能使用“localhost”这个host 名字来代替回环地址“127.0.0.1”,或者IPv6里面的[::1]。

null

###介绍

null

引导配置MO 提供管理设备引导功能的能力。这个MO必须禁止用来管理DM 服务器的初始访问权限，除非DM 客户端是由其中至少一个DM Server 来引导的。

null

这个MO的支持是可选的。

null

###图形表示

null

图6给除了引导配置MO的图形表示

## 引导配置模块

null

null

null

null

这个节点代表了是否允许设备发现一个DM 引导服务器。节点允许的值在下面的表格中表示。

null

这个内部节点是存储DM 引导服务器URLs、相关证书以及访问权限信息 的子树的父节点。

null

这个叶节点的值是一个引导服务器的URL。

null

这个内部节点是所有初始访问权限信息的根节点。如果这个节点不存在，那么这个初始的ACL访问权限是有每台设备的策略来绝地给你。

null

这个占位符节点是在管理树里面的一个子树的初始访问权限信息的根节点。

null

这个节点的值是管理树的一个子树的的根节点的URI。

null

这个节点指定了DM 服务器在子树获得初始访问权限，它的根是用来指定在成功完成引导程序时子树URI 节点的值。此节点有效的值是下表中任意一个访问类型的值，或者任何包含访问类型值的 bit-wise ORing 的值。

null

这个内节点存储了供应商特定的扩展DM管理引导服务器的URL。

这个内部节点是所有初始访问权限信息的根节点。如果这个节点不存在，那么这个初始的ACL访问权限是有每台设备的策略来绝地给你。

树的初始访问权限信息的根节点。

这个节点的值是管理树的一个子树的的根节点的URI。

这个节点指定了DM 服务器在子树获得初始访问权限，它的根是用来指定在成功完成引导程序时子树URI 节点的值。此节点有效的值是下表中任意一个访问类型的值，或者任何包含访问类型值的 bit-wise ORing 的值。

null

比如，如果ACL的权限只有GET，那么这个节点的值就是1.如果ACL 的权限是GET、ADD和DELETE，那么这个节点的值就是49。

null

如果该值的SubtreeURI 节点没有对应管理树上的节点，那么这个节点的值就会被忽略。

null

